# CNS-Trace Transcription Factor Binding Evolution Model in Plants

This model implements [Stormo's binding model](https://doi.org/10.1093/bioinformatics/16.1.16) to estimate transcription factor (TF) affinity to conserved non-coding sequences (CNS) across evolutionary time. By integrating phylogenetics and sequence analysis, it reconstructs ancestral CNS sequences using FastML, allowing the inference of TF binding site gain, loss, or retention throughout plant evolution.

Was built as part of [Conservatory plant CNS project.](https://conservatorycns.com/).
For conservatory data files [click here.](https://conservatorycns.com/dist/pages/conservatory/analysis.php)

The approach combines TF binding energy modeling with a neutral evolution framework to assess whether observed binding changes are due to selection or drift.

Energy model is based on PWMs generated by DAP-seq experiments and genome background GC rate, sequence reconstruction uses [FastML](https://fastml.tau.ac.il/).

Repository currently contains only files for TF "ARF5 (MP)" and CNS "Angioeperms_1221". 

Instructions on how to add pwms will be added in the future.

## Uses
### Predict binding of transcription factors to sequences
Use python script named getBindingEnergy.py with input and output filenames. The script takes a csv that contains sequence_ID, species and sequence. 

Species name should be passed as it appears in the Conservatory genome database (otherwise default GC values will be used for energy model)

Script assumes conservatory map file format (1st col = CNS_ID, 2nd col = SPECIES, 7th col = Sequence), if using custom format pass in command line arguments (use 0-based indexing).

Example Usage:

`python3 scripts/getBindingEnergy.py -i Angiosperms_1221.map.csv -o Angiosperms_1221.energies.csv`

### Predict evolutionary events in transcription factor binding energy
First run init.py for all CNS ids you wish to run (needs to be done once for any CNS). 

CNS and map file are defaulted to the data files found on https://conservatorycns.com/, for demo use files in repository (Angiosperms_1221.cns.csv, Angiosperms_1221.map.csv)

`python3 scripts/init.py --cns_id Angiosperms_1221 --cns_file Angiosperms_1221.cns.csv --map_file Angiosperms_1221.map.csv`

if using the original conservatory files:
`python3 scripts/init.py --cns_id Angiosperms_1221`

This will create a trimmed phylogenetic tree for all species containing the CNS and reconstruct ancestral sequences.

now you can use:

`python3 scripts/getEventHistory.py Angiosperms_1221`

The result file will contain all pairs of nodes and the difference in binding energy for each TF, including binding classification.
